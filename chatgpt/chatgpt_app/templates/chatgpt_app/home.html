<!DOCTYPE html>
<html>
<head>
  <title>ChatGPT</title>
  <style>
    .chatbox {
      height: 80vh;
      width: 600px;
      overflow: auto;
      border: 1px solid #ccc;
      padding: 10px;
      margin: 10px auto;
      background-color: #f5f5f5;
    }

    .user-message {
      background-color: #fff;
      color: #000;
      width: 60%;
      margin-right: auto;
      margin-left: 10px;
      margin-bottom: 5px;
      padding: 10px;
      border-radius: 10px;
      float: right;
    }

    .bot-message {
      background-color: #ccc;
      color: #000;
     width: 60%;
      margin-right: 10px;
      margin-left: auto;
      margin-bottom: 5px;
      padding: 10px;
      border-radius: 10px;
      float: left;
    }
  </style>
</head>
<body>
    <div class="chatbox">
        {% for message in messages %}
          {% if message.sender == 'user' %}
            <div class="user-message">
              {{ message.message }}
            </div>
          {% endif %}
          {% if message.sender == 'bot' %}
            <div class="bot-message">
              {{ message.message }}
            </div>
          {% endif %}
        {% endfor %}
      </div>
    <div style="text-align:center">
  <form method="post"  autocomplete="off">
    {% csrf_token %}
    <label for="prompt">Ask Here:</label><br>
    <input type="text" id="prompt" name="prompt" style="width: 50%;">
    <br><br>
    <input type="submit" value="Send">
  </form> 

  
    <button id="start-button">Record</button>
  </div>
  <div id="result"></div>
  <script>
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = true;

    let isRecording = false;
    let finalTranscript = '';

    recognition.onresult = (event) => {
      let interimTranscript = '';
      for (let i = event.resultIndex; i < event.results.length; i++) {
        let transcript = event.results[i][0].transcript;
        if (event.results[i].isFinal) {
          finalTranscript += transcript;
        } else {
          interimTranscript += transcript;
        }
      }
      document.getElementById('prompt').value = finalTranscript + interimTranscript;
    };

    recognition.onstart = () => {
      isRecording = true;
      document.getElementById('start-button').disabled = true;
    };

    recognition.onend = () => {
      isRecording = false;
      document.getElementById('start-button').disabled = false;
    };

    recognition.onerror = (event) => {
      console.error(event.error);
    };

    document.getElementById('start-button').addEventListener('click', () => {
      if (!isRecording) {
        recognition.start();
        setTimeout(() => {
          recognition.stop();
        }, 4000);
      }
    });
  </script>
</body>
</html>
